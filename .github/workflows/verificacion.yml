name: ðŸ§ª VerificaciÃ³n de Ejercicios

on:
  push:
    branches: [main, master]

permissions:
  contents: read

jobs:
  verificar-python:
    name: ðŸ Verificar Python
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout del cÃ³digo
        uses: actions/checkout@v4
      
      - name: ðŸ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      
      - name: ðŸ“¦ Instalar pytest
        run: pip install pytest
      
      - name: ðŸ§ª Ejecutar tests de Python
        id: pytest
        run: pytest tests/test_python.py -v --tb=short
        continue-on-error: true
      
      - name: ðŸ“Š Generar resumen de Python
        if: always()
        run: |
          if [ "${{ steps.pytest.outcome }}" == "success" ]; then
            echo "## ðŸ Python - âœ… APROBADO" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Â¡Excelente! Todos los tests de Python pasaron correctamente." >> $GITHUB_STEP_SUMMARY
          else
            echo "## ðŸ Python - âŒ PENDIENTE" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Los tests de Python no pasaron. Revisa la salida del paso anterior para ver los errores." >> $GITHUB_STEP_SUMMARY
          fi
      
      - name: âŒ Fallar si los tests no pasaron
        if: steps.pytest.outcome != 'success'
        run: exit 1

  verificar-javascript:
    name: ðŸ“¦ Verificar JavaScript
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout del cÃ³digo
        uses: actions/checkout@v4
      
      - name: ðŸ“¦ Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: ðŸ“¦ Instalar Jest
        run: npm install --save-dev jest
      
      - name: ðŸ§ª Ejecutar tests de JavaScript
        id: jest
        run: npx jest tests/test_javascript.test.js --verbose
        continue-on-error: true
      
      - name: ðŸ“Š Generar resumen de JavaScript
        if: always()
        run: |
          if [ "${{ steps.jest.outcome }}" == "success" ]; then
            echo "## ðŸ“¦ JavaScript - âœ… APROBADO" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Â¡Excelente! Todos los tests de JavaScript pasaron correctamente." >> $GITHUB_STEP_SUMMARY
          else
            echo "## ðŸ“¦ JavaScript - âŒ PENDIENTE" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Los tests de JavaScript no pasaron. Revisa la salida del paso anterior para ver los errores." >> $GITHUB_STEP_SUMMARY
          fi
      
      - name: âŒ Fallar si los tests no pasaron
        if: steps.jest.outcome != 'success'
        run: exit 1

  resultado-final:
    name: ðŸ“‹ Resultado Final
    runs-on: ubuntu-latest
    needs: [verificar-python, verificar-javascript]
    if: always()
    
    steps:
      - name: ðŸ“Š Generar resumen final
        run: |
          echo "# ðŸŽ¯ Resultado de la Prueba de FamiliarizaciÃ³n" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          PYTHON_STATUS="${{ needs.verificar-python.result }}"
          JS_STATUS="${{ needs.verificar-javascript.result }}"
          
          echo "## ðŸ“Š Resumen de Ejercicios" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Ejercicio | Estado |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|--------|" >> $GITHUB_STEP_SUMMARY
          
          if [ "$PYTHON_STATUS" == "success" ]; then
            echo "| ðŸ Python | âœ… Aprobado |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ðŸ Python | âŒ Pendiente |" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "$JS_STATUS" == "success" ]; then
            echo "| ðŸ“¦ JavaScript | âœ… Aprobado |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ðŸ“¦ JavaScript | âŒ Pendiente |" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "$PYTHON_STATUS" == "success" ] && [ "$JS_STATUS" == "success" ]; then
            echo "## ðŸŽ‰ Â¡Felicidades!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Has completado exitosamente la prueba de familiarizaciÃ³n." >> $GITHUB_STEP_SUMMARY
            echo "Ya conoces el flujo de trabajo para la prueba tÃ©cnica real." >> $GITHUB_STEP_SUMMARY
          else
            echo "## ðŸ’ª Â¡Sigue intentando!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "AÃºn hay ejercicios pendientes. Revisa los errores y vuelve a hacer push." >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“ Recordatorios para la Prueba Real" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- â° **Tiempo lÃ­mite:** 90 minutos" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ’» **Tipo:** Fullstack (Python/JavaScript + frameworks)" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ’¯ **Puntaje mÃ¡ximo:** 100 puntos" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ”„ **Intentos:** Solo uno" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Â¡Buena suerte en tu prueba! ðŸš€**" >> $GITHUB_STEP_SUMMARY
